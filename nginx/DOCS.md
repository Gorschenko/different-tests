# Директивы:

- include PATH_TO_FILE - позволяет подключать другие файлы;
- client_max_body_size VALUE - определяет максимальный размер файла;
- return HTTP_CODE URL/TEXT - возвращает текст или делает редирект. Частый пример использования - редирект всех доменов на HTTPS - return 301 https://$host$request_uri/;

## Server

Определяет виртуальный хост.

- server_name DNS_NAME_1 DNS_NAME_2 - указывает какие dns имена будет обрабатывать сервер;
- listen PORT OPTIONS - определяет порт.

OPTIONS:

1. listen 443 ssl
2. listen 80 default_server - запросы без указания host будут обарабатываться этим сервером.

- root PATH_TO_FILE - пользовательский запрос добавляется к PATH_TO_FILE. Определяется в server или location;
- alias PATH_TO_FILE - работает как и root, но откидывает значение /PATH в location;
- index FILE1 FILE2 - подставляет файл, если пользователь не указал;
- try_files - проверяет файлы, изменяя их пути; перекидывает запросы на именованные location;

location / {
    try_files $uri $uri/ /index.php$args
}
При обработке / проверяется существование файла в системе, если он есть, то он возвращается пользователю. Дальше к запросу добавляется / и проверяется наличие директории, внутри которой лежит index-файл. Если не сработали оба варианта, то запрос идет на /index.php.

## Location

Паттерн: location <modifier> <prefix>.

Modifier:

1. Отсутствует. Тогда опредление пути будет по самому длинному соответствую в пути.
2. =. Путь должен точь-в-точь соответствовать. Приоритет выше, чем когда модификатор отсутствует.
3. ~. Регистрозависимый regexp. Приоритет выше, чем когда модификатор отсутствует.
4. ~*. regexp без учета регистра.
5. ^~. Повышает приоритет простого location над regexp.
6. Может быть именованным:
error_page 404 = @not_found;
location @not_found {}
Недоступны извне, применяются только для внутренних запросов.

Location могут быть вложенными. Исключения:

- Если есть =, то вложенность не реализовать.
- ~ и ~* внутри себя могут содержать location с аналогичными модификаторами. 

### Rewrite

Паттерн: rewrite <regexp> <final> <flag>

- final - финальный вид строки;
- flag - влияет на последующее поведение nginx;

Флаги:

- redirect - временный редирект 302;
- permanent - постоянный редирект 301;
- last - указывает, что rewrite был последним, далее пойдет новый поиск по измененному location.
- break (дефолтное) - прекращает обработку rewrite и выполняет поиск в текущем location.

Можно указать $1, что перезапишет аргументы:
rewrite ^/test2/(.*)$ /good/$1; - все что было после test2, будет добавлено в конец.

rewrite ^/download/(.*)$ /get.php?file=$1? - откинет все параметры, которые были в запросе до:
example.com/test.zip?ts=123 => example.com/get.php?file=test.zip.

